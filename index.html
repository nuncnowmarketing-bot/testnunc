```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>nunc</title>
  <link rel="stylesheet" href="./assets/app.css">
<style>
  .feed-shell{
    width:100%;
    max-width:100%;
    margin:0;
    border:1px solid var(--hair);
    background:var(--panel);
    border-radius:0;
    overflow:hidden;
  }

  .feed-header{
    padding:18px 18px 14px;
    border-bottom:1px solid var(--hair);
    display:flex;
    align-items:baseline;
    justify-content:space-between;
    gap:12px;
  }

  .feed-title{
    font-size:22px;
    font-weight:600;
    margin:0;
    letter-spacing:0.1px;
  }

  .feed{display:flex;flex-direction:column;}

  .post{
    display:grid;
    grid-template-columns: 64px 1fr 44px;
    gap:14px;
    padding:16px 18px;
    border-bottom:1px solid var(--hair);
  }

  .rank{
    font-size:14px;
    color:var(--muted);
    text-align:right;
    padding-top:2px;
    white-space:nowrap;
  }

  .content{
    display:flex;
    flex-direction:column;
    gap:6px;
    min-width:0;
  }

  .title{
    font-size:18px;
    font-weight:600;
    line-height:1.25;
    word-wrap:break-word;
    overflow-wrap:anywhere;
  }

  .meta{
    font-size:13px;
    line-height:1.35;
    color:var(--muted);
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    align-items:center;
  }

  .dot{
    width:3px;
    height:3px;
    border-radius:999px;
    background:var(--muted);
    opacity:0.6;
    display:inline-block;
    transform:translateY(-1px);
  }

  .boost{
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    color:var(--muted);
    cursor:pointer;
    user-select:none;
    width:44px;
    height:36px;
    border:1px solid transparent;
    border-radius:10px;
    background:transparent;
  }

  .boost:hover{
    color:var(--text);
    border-color:var(--hair);
    background:var(--pill);
  }

  .boost::after{
    content:"boost";
    position:absolute;
    bottom:120%;
    right:0;
    padding:6px 10px;
    font-size:12px;
    color:var(--text);
    background:var(--panel2);
    border:1px solid var(--hair);
    border-radius:8px;
    white-space:nowrap;
    opacity:0;
    pointer-events:none;
    transform:translateY(4px);
    transition:opacity 0.15s ease, transform 0.15s ease;
  }

  .boost:hover::after{opacity:1;transform:translateY(0)}

  .feed-footer{
    padding:14px 18px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    color:var(--muted);
    font-size:13px;
    border-top:1px solid var(--hair);
    background:linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,0.12));
  }

  .status{
    display:flex;
    align-items:center;
    gap:10px;
    min-height:20px;
  }

  .spinner{
    width:14px;
    height:14px;
    border-radius:999px;
    border:2px solid var(--hair);
    border-top-color:rgba(255,255,255,0.55);
    animation:spin 0.8s linear infinite;
    display:none;
  }

  .loading .spinner{display:inline-block}
  @keyframes spin{to{transform:rotate(360deg)}}

  @media (max-width:520px){
    .post{grid-template-columns:56px 1fr 44px; padding:14px 14px}
    .feed-header{padding:16px 14px 12px}
    .title{font-size:17px}
  }

  .toast{
    position:fixed;
    left:50%;
    bottom:18px;
    transform:translateX(-50%);
    background:rgba(0,0,0,0.82);
    border:1px solid var(--hair);
    padding:10px 12px;
    border-radius:12px;
    display:none;
    z-index:60;
  }

  /* payment modal (index-specific) */
  .modal-backdrop{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.62);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:55;
    padding:18px;
  }

  .modal{
    width:min(560px,100%);
    border:1px solid var(--hair);
    background:linear-gradient(180deg,var(--panel),var(--panel2));
    border-radius:18px;
    box-shadow:0 18px 50px rgba(0,0,0,0.55);
    padding:16px;
  }

  .modal h2{margin:0 0 10px;font-size:20px}
  .modal .muted{color:var(--muted);font-size:14px;margin:0 0 12px}
  .modal .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0}
  .modal .grid .cell{display:flex;flex-direction:column;gap:6px}

  .modal input,.modal select{
    padding:10px 12px;
    border-radius:14px;
    border:1px solid var(--hair);
    background:rgba(255,255,255,0.03);
    color:var(--text);
    font:inherit;
    font-size:16px;
    outline:none;
  }

  .modal select option{background:#161616;color:#ffffff;}

  .modal .summary{
    border:1px solid var(--hair);
    background:rgba(255,255,255,0.03);
    border-radius:14px;
    padding:10px 12px;
    display:flex;
    flex-direction:column;
    gap:6px;
    margin:10px 0 12px;
  }

  .modal .summary .line{display:flex;justify-content:space-between;gap:10px;color:var(--muted);font-size:14px}
  .modal .summary .line strong{color:var(--text);font-weight:700}
  .modal .actions{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap;margin-top:10px}

  .fineprint{margin:10px 0 0;color:var(--muted);font-size:12px;line-height:1.35}
</style>
  <script src="./assets/app.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="nav">
        <div class="brand">
          <a class="logo" href="./index.html">nunc</a>
        </div>
        <div class="nav-actions">
          <a class="pill" href="./index.html">leaderboard</a>
          <a class="pill" href="./explore.html">explore</a>
          <a class="pill" href="./post.html">post</a>
          <a class="pill" href="./login.html">log in</a>
        </div>
      </div>
    </header>

    <main>
      <section class="feed-shell" aria-label="Global feed">
        <div class="feed-header">
          <h2 class="feed-title">Global leaderboard</h2>
        </div>

        <div id="feed" class="feed"></div>

        <div class="feed-footer" id="feedFooter">
          <div class="status" id="status">
            <span class="spinner" aria-hidden="true"></span>
            <span id="statusText">Loaded 0 posts</span>
          </div>
          <div id="hint">scroll</div>
        </div>

        <div id="sentinel" style="height:1px"></div>
      </section>
    </main>

    <footer>
      <div class="foot">
        <div>© nunc</div>
        <div>terms · transparency · ledger</div>
      </div>
    </footer>
  </div>

  <div class="toast" id="toast"></div>

  <!-- Payment modal (used for boosts) -->
  <div class="modal-backdrop" id="payBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="payTitle">
      <h2 id="payTitle">Pay to boost</h2>
      <p class="muted">1 USD = 1 boost. Foreign currencies convert to USD at live FX rates.</p>

      <div class="grid">
        <div class="cell">
          <label for="payAmount">Amount</label>
          <input id="payAmount" inputmode="decimal" autocomplete="off" placeholder="10" />
        </div>
        <div class="cell">
          <label for="payCurrency">Currency</label>
          <select id="payCurrency">
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
            <option value="GBP">GBP</option>
            <option value="CAD">CAD</option>
            <option value="AUD">AUD</option>
            <option value="NZD">NZD</option>
            <option value="JPY">JPY</option>
            <option value="CNY">CNY</option>
            <option value="KRW">KRW</option>
            <option value="INR">INR</option>
            <option value="CHF">CHF</option>
            <option value="SEK">SEK</option>
            <option value="NOK">NOK</option>
            <option value="DKK">DKK</option>
            <option value="PLN">PLN</option>
            <option value="CZK">CZK</option>
            <option value="HUF">HUF</option>
            <option value="RON">RON</option>
            <option value="BGN">BGN</option>
            <option value="TRY">TRY</option>
            <option value="ILS">ILS</option>
            <option value="AED">AED</option>
            <option value="SAR">SAR</option>
            <option value="BRL">BRL</option>
            <option value="MXN">MXN</option>
            <option value="CLP">CLP</option>
            <option value="COP">COP</option>
            <option value="PEN">PEN</option>
            <option value="ZAR">ZAR</option>
            <option value="NGN">NGN</option>
            <option value="EGP">EGP</option>
            <option value="KES">KES</option>
            <option value="SGD">SGD</option>
            <option value="HKD">HKD</option>
            <option value="TWD">TWD</option>
            <option value="THB">THB</option>
            <option value="MYR">MYR</option>
            <option value="IDR">IDR</option>
            <option value="PHP">PHP</option>
          </select>
        </div>
      </div>

      <div class="summary">
        <div class="line"><span>FX source</span><strong id="fxSource">—</strong></div>
        <div class="line"><span>Converted</span><strong id="usdOut">—</strong></div>
        <div class="line"><span>Boosts</span><strong id="boostOut">—</strong></div>
      </div>

      <div class="actions">
        <button class="btn ghost" id="cancelPay">Cancel</button>
        <button class="btn gold" id="confirmPay">Pay & Boost</button>
      </div>

      <p class="fineprint">Static demo: shows a payment-style popup and FX conversion. No real payment is processed.</p>
    </div>
  </div>

  <script>
    // Leaderboard feed: ONLY locally saved posts from post.html (nunc_posts_v1). No auto-generated samples.

    const FEED = document.getElementById('feed');
    const SENTINEL = document.getElementById('sentinel');
    const STATUS = document.getElementById('status');
    const STATUS_TEXT = document.getElementById('statusText');
    const TOAST = document.getElementById('toast');

    // Storage keys
    const POSTS_KEY  = 'nunc_posts_v1';    // array of {id,text,country,createdAt,expiresAt,boosts}
    const BOOSTS_KEY = 'nunc_boosts_v1';   // map { [postId]: number }

    const ONE_DAY_MS = 86400000;
    const now = () => Date.now();

    const toastMsg = (m) => {
      TOAST.textContent = m;
      TOAST.style.display = 'block';
      setTimeout(() => TOAST.style.display = 'none', 1800);
    };

    // ---------- Payment modal + FX ----------
    const payBackdrop = document.getElementById('payBackdrop');
    const payAmount   = document.getElementById('payAmount');
    const payCurrency = document.getElementById('payCurrency');
    const fxSource    = document.getElementById('fxSource');
    const usdOut      = document.getElementById('usdOut');
    const boostOut    = document.getElementById('boostOut');
    const cancelPay   = document.getElementById('cancelPay');
    const confirmPay  = document.getElementById('confirmPay');

    const parseAmount = (v)=>{
      const n = Number(String(v).replace(',','.').trim());
      return Number.isFinite(n) ? n : NaN;
    };

    async function convertToUSD(amount, currency){
      if(currency === 'USD') return { usd: amount, source: 'USD (no conversion)' };
      const url = 'https://api.frankfurter.app/latest?amount=' + encodeURIComponent(amount) +
                  '&from=' + encodeURIComponent(currency) + '&to=USD';
      try{
        const res = await fetch(url, { cache:'no-store' });
        if(!res.ok) throw new Error('fx_http_'+res.status);
        const data = await res.json();
        const usd = data && data.rates && typeof data.rates.USD === 'number' ? data.rates.USD : NaN;
        if(!Number.isFinite(usd)) throw new Error('fx_parse');
        return { usd, source: 'Frankfurter (ECB)' };
      }catch(_){
        return { usd: amount, source: 'FX unavailable (1:1 fallback)' };
      }
    }

    let conversionTimer = null;
    const computeConversion = ()=>{
      clearTimeout(conversionTimer);
      conversionTimer = setTimeout(async ()=>{
        const amt = parseAmount(payAmount.value);
        const cur = payCurrency.value;

        if(!Number.isFinite(amt) || amt <= 0){
          fxSource.textContent='—';
          usdOut.textContent='—';
          boostOut.textContent='—';
          return;
        }

        fxSource.textContent='Converting…';
        usdOut.textContent='…';
        boostOut.textContent='…';

        const r = await convertToUSD(amt, cur);
        const usd = r.usd;
        const boosts = Math.max(0, Math.floor(usd));

        fxSource.textContent = r.source;
        usdOut.textContent = usd.toFixed(2) + ' USD';
        boostOut.textContent = boosts + ' boosts';
      }, 120);
    };

    payAmount.addEventListener('input', computeConversion);
    payCurrency.addEventListener('change', computeConversion);

    const openPay = ()=>{
      payBackdrop.style.display='flex';
      payBackdrop.setAttribute('aria-hidden','false');
      if(!payAmount.value) payAmount.value = '1';
      fxSource.textContent='—';
      usdOut.textContent='—';
      boostOut.textContent='—';
      computeConversion();
    };

    const closePay = ()=>{
      payBackdrop.style.display='none';
      payBackdrop.setAttribute('aria-hidden','true');
      pendingBoostPostId = '';
    };

    cancelPay.addEventListener('click', closePay);
    payBackdrop.addEventListener('click', (e)=>{ if(e.target === payBackdrop) closePay(); });
    document.addEventListener('keydown', (e)=>{ if(payBackdrop.style.display === 'flex' && e.key === 'Escape') closePay(); });

    const loadBoosts = ()=>{
      try{ return JSON.parse(localStorage.getItem(BOOSTS_KEY) || '{}') || {}; }
      catch(_){ return {}; }
    };
    const saveBoosts = (m)=>localStorage.setItem(BOOSTS_KEY, JSON.stringify(m));

    const loadPosts = ()=>{
      try{ return JSON.parse(localStorage.getItem(POSTS_KEY) || '[]') || []; }
      catch(_){ return []; }
    };
    const savePosts = (arr)=>localStorage.setItem(POSTS_KEY, JSON.stringify(arr));

    function prunePosts(posts){
      const alive = posts.filter(p => p && typeof p.expiresAt === 'number' ? p.expiresAt > now() : (p && typeof p.createdAt === 'number' ? (now()-p.createdAt) < ONE_DAY_MS : true));
      if(alive.length !== posts.length) savePosts(alive);
      return alive;
    }

    function mergeBoostsIntoPosts(posts){
      const map = loadBoosts();
      let changed = false;
      const out = posts.map(p => {
        if(!p || !p.id) return p;
        const b = Number(map[p.id] || 0);
        if(Number(p.boosts || 0) !== b){ changed = true; return { ...p, boosts: b }; }
        return p;
      });
      if(changed) savePosts(out);
      return out;
    }

    function setMetaBoostCount(metaEl, n){
      let span = metaEl.querySelector('[data-boost-count]');
      if(!span){
        const dot = document.createElement('span');
        dot.className = 'dot';
        span = document.createElement('span');
        span.setAttribute('data-boost-count','1');
        metaEl.appendChild(dot);
        metaEl.appendChild(span);
      }
      span.textContent = n + ' boosts';
    }

    let pendingBoostPostId = '';

    async function finalizeBoost(){
      const amt = parseAmount(payAmount.value);
      const cur = payCurrency.value;
      if(!Number.isFinite(amt) || amt <= 0) return toastMsg('Payment blocked: invalid amount.');

      const r = await convertToUSD(amt, cur);
      const add = Math.max(0, Math.floor(r.usd));
      if(add < 1) return toastMsg('Payment blocked: must equal at least 1 boost (>= $1).');
      if(!pendingBoostPostId) return toastMsg('Boost failed: missing post id.');

      const map = loadBoosts();
      const prev = Number(map[pendingBoostPostId] || 0);
      const next = prev + add;
      map[pendingBoostPostId] = next;
      saveBoosts(map);

      // Sync into posts list (real posts only)
      const posts = prunePosts(loadPosts());
      const idx = posts.findIndex(p => p && p.id === pendingBoostPostId);
      if(idx >= 0){
        posts[idx].boosts = next;
        savePosts(posts);
      } else {
        closePay();
        return toastMsg('Boost failed: post not found.');
      }

      closePay();
      toastMsg('Boosted +'+add+'.');
      renderFresh();
    }

    confirmPay.addEventListener('click', finalizeBoost);

    // ---------- Rendering ----------
    function fmtTimeAgo(ts){
      const diff = Math.max(0, now() - ts);
      const mins = Math.floor(diff / 60000);
      if(mins <= 0) return 'just now';
      if(mins < 60) return mins + 'm';
      const hrs = Math.floor(mins / 60);
      if(hrs < 24) return hrs + 'h';
      return '1d';
    }

    function makeRow({ rank, id, text, country, timeLabel, boosts, createdAt }){
      const row = document.createElement('div');
      row.className = 'post';
      row.dataset.postId = id;

      const rankEl = document.createElement('div');
      rankEl.className = 'rank';
      rankEl.textContent = `#${rank}`;

      const content = document.createElement('div');
      content.className = 'content';

      const titleEl = document.createElement('div');
      titleEl.className = 'title';
      titleEl.textContent = text;

      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.innerHTML = `${country} <span class="dot"></span> ${timeLabel}`;

      if(Number(boosts || 0) > 0) setMetaBoostCount(meta, Number(boosts || 0));

      content.appendChild(titleEl);
      content.appendChild(meta);

      const boostBtn = document.createElement('button');
      boostBtn.className = 'boost';
      boostBtn.type = 'button';
      boostBtn.setAttribute('aria-label', 'boost');
      boostBtn.textContent = '▲';
      boostBtn.addEventListener('click', ()=>{
        pendingBoostPostId = id;
        openPay();
      });

      row.appendChild(rankEl);
      row.appendChild(content);
      row.appendChild(boostBtn);

      return row;
    }

    function setLoading(isLoading){
      if(isLoading) STATUS.classList.add('loading');
      else STATUS.classList.remove('loading');
    }

    let allPosts = [];
    let cursor = 0;
    let loaded = 0;
    const BATCH = 12;

    function updateStatus(){
      STATUS_TEXT.textContent = `Loaded ${loaded} posts`;
    }

    function sortLeaderboard(posts){
      posts.sort((a,b)=>{
        const ba = Number(a?.boosts || 0), bb = Number(b?.boosts || 0);
        if(bb !== ba) return bb - ba;
        const ta = Number(a?.createdAt || 0), tb = Number(b?.createdAt || 0);
        if(tb !== ta) return tb - ta;
        return String(a?.id||'').localeCompare(String(b?.id||''));
      });
      return posts;
    }

    function rebuildDataset(){
      let posts = prunePosts(loadPosts());
      posts = mergeBoostsIntoPosts(posts);
      allPosts = sortLeaderboard(posts.filter(p => p && p.id && p.text));
      cursor = 0;
    }

    function renderEmptyState(){
      FEED.innerHTML = '';
      loaded = 0;
      updateStatus();
      const row = document.createElement('div');
      row.className = 'post';
      row.innerHTML = `
        <div class="rank">—</div>
        <div class="content">
          <div class="title">No posts yet</div>
          <div class="meta">Create a post on the post page.</div>
        </div>
        <div></div>
      `;
      FEED.appendChild(row);
    }

    function appendRealBatch(){
      if(cursor >= allPosts.length) return;
      setLoading(true);

      window.setTimeout(() => {
        const frag = document.createDocumentFragment();
        const startRank = cursor + 1;

        for(let i=0;i<BATCH && cursor < allPosts.length;i++, cursor++){
          const p = allPosts[cursor];
          frag.appendChild(makeRow({
            rank: startRank + i,
            id: p.id,
            text: String(p.text).slice(0,200),
            country: p.country || '—',
            timeLabel: p.createdAt ? fmtTimeAgo(p.createdAt) : '—',
            boosts: Number(p.boosts || 0),
            createdAt: Number(p.createdAt || 0)
          }));
          loaded++;
        }

        FEED.appendChild(frag);
        updateStatus();
        setLoading(false);
      }, 180);
    }

    function renderFresh(){
      FEED.innerHTML = '';
      loaded = 0;
      rebuildDataset();

      if(allPosts.length === 0){
        renderEmptyState();
        return;
      }

      appendRealBatch();
    }

    renderFresh();

    const io = new IntersectionObserver((entries) => {
      for(const e of entries){
        if(e.isIntersecting){
          appendRealBatch();
        }
      }
    }, { root:null, rootMargin:'600px 0px', threshold:0 });

    io.observe(SENTINEL);

    // Keep leaderboard live across tabs and same tab changes.
    // If assets/app.js already broadcasts, this still works.
    window.addEventListener('storage', (e)=>{
      if(e.key === POSTS_KEY || e.key === BOOSTS_KEY){
        renderFresh();
      }
    });
  </script>
</body>
</html>
```
